{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/middleware.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\r\nimport type { NextRequest } from 'next/server'\r\n\r\n// Rutas públicas (no requieren autenticación)\r\nconst publicRoutes = ['/login', '/api/config']\r\n\r\n// Rutas que requieren autenticación\r\nconst protectedRoutes = ['/dashboard', '/nuevo-viatico', '/mis-viaticos', '/admin']\r\n\r\n// Rutas que requieren rol admin\r\nconst adminRoutes = ['/admin']\r\n\r\nexport function middleware(request: NextRequest) {\r\n  const { pathname } = request.nextUrl\r\n\r\n  // Permitir rutas públicas y API routes (excepto las que requieren auth)\r\n  if (publicRoutes.some(route => pathname.startsWith(route))) {\r\n    return NextResponse.next()\r\n  }\r\n\r\n  // Permitir archivos estáticos y PWA\r\n  if (\r\n    pathname.startsWith('/_next') ||\r\n    pathname.startsWith('/api') ||\r\n    pathname.startsWith('/static') ||\r\n    pathname.includes('.') ||\r\n    pathname === '/manifest.json' ||\r\n    pathname.startsWith('/icons/')\r\n  ) {\r\n    return NextResponse.next()\r\n  }\r\n\r\n  // Verificar si hay token de Firebase en cookies\r\n  const firebaseToken = request.cookies.get('firebase-token')?.value\r\n\r\n  // Si no hay token y está intentando acceder a una ruta protegida\r\n  if (!firebaseToken && protectedRoutes.some(route => pathname.startsWith(route))) {\r\n    const loginUrl = new URL('/login', request.url)\r\n    loginUrl.searchParams.set('redirect', pathname)\r\n    return NextResponse.redirect(loginUrl)\r\n  }\r\n\r\n  // Si hay token pero intenta acceder a /admin, permitir (la verificación de rol se hace en el cliente)\r\n  // El middleware solo verifica autenticación básica\r\n  if (firebaseToken && adminRoutes.some(route => pathname.startsWith(route))) {\r\n    // Permitir acceso, pero el componente verificará el rol\r\n    return NextResponse.next()\r\n  }\r\n\r\n  // Si está autenticado e intenta acceder a /login, redirigir a dashboard\r\n  if (firebaseToken && pathname === '/login') {\r\n    return NextResponse.redirect(new URL('/dashboard', request.url))\r\n  }\r\n\r\n  return NextResponse.next()\r\n}\r\n\r\nexport const config = {\r\n  matcher: [\r\n    /*\r\n     * Match all request paths except for the ones starting with:\r\n     * - _next/static (static files)\r\n     * - _next/image (image optimization files)\r\n     * - favicon.ico (favicon file)\r\n     */\r\n    '/((?!_next/static|_next/image|favicon.ico).*)',\r\n  ],\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;;AAAA;AAAA;;AAGA,8CAA8C;AAC9C,MAAM,eAAe;IAAC;IAAU;CAAc;AAE9C,oCAAoC;AACpC,MAAM,kBAAkB;IAAC;IAAc;IAAkB;IAAiB;CAAS;AAEnF,gCAAgC;AAChC,MAAM,cAAc;IAAC;CAAS;AAEvB,SAAS,WAAW,OAAoB;IAC7C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IAEpC,wEAAwE;IACxE,IAAI,aAAa,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC,SAAS;QAC1D,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,oCAAoC;IACpC,IACE,SAAS,UAAU,CAAC,aACpB,SAAS,UAAU,CAAC,WACpB,SAAS,UAAU,CAAC,cACpB,SAAS,QAAQ,CAAC,QAClB,aAAa,oBACb,SAAS,UAAU,CAAC,YACpB;QACA,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,gDAAgD;IAChD,MAAM,gBAAgB,QAAQ,OAAO,CAAC,GAAG,CAAC,mBAAmB;IAE7D,iEAAiE;IACjE,IAAI,CAAC,iBAAiB,gBAAgB,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC,SAAS;QAC/E,MAAM,WAAW,IAAI,IAAI,UAAU,QAAQ,GAAG;QAC9C,SAAS,YAAY,CAAC,GAAG,CAAC,YAAY;QACtC,OAAO,gMAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,sGAAsG;IACtG,mDAAmD;IACnD,IAAI,iBAAiB,YAAY,IAAI,CAAC,CAAA,QAAS,SAAS,UAAU,CAAC,SAAS;QAC1E,wDAAwD;QACxD,OAAO,gMAAY,CAAC,IAAI;IAC1B;IAEA,wEAAwE;IACxE,IAAI,iBAAiB,aAAa,UAAU;QAC1C,OAAO,gMAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,cAAc,QAAQ,GAAG;IAChE;IAEA,OAAO,gMAAY,CAAC,IAAI;AAC1B;AAEO,MAAM,SAAS;IACpB,SAAS;QACP;;;;;KAKC,GACD;KACD;AACH"}}]
}