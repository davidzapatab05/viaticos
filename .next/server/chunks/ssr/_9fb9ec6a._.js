module.exports=[19345,a=>{"use strict";var b=a.i(72131);let c=0,d=new Map,e=a=>{if(d.has(a))return;let b=setTimeout(()=>{d.delete(a),h({type:"REMOVE_TOAST",toastId:a})},1e6);d.set(a,b)},f=[],g={toasts:[]};function h(a){g=((a,b)=>{switch(b.type){case"ADD_TOAST":return{...a,toasts:[b.toast,...a.toasts].slice(0,1)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(a=>a.id===b.toast.id?{...a,...b.toast}:a)};case"DISMISS_TOAST":{let{toastId:c}=b;return c?e(c):a.toasts.forEach(a=>{e(a.id)}),{...a,toasts:a.toasts.map(a=>a.id===c||void 0===c?{...a,open:!1}:a)}}case"REMOVE_TOAST":if(void 0===b.toastId)return{...a,toasts:[]};return{...a,toasts:a.toasts.filter(a=>a.id!==b.toastId)}}})(g,a),f.forEach(a=>{a(g)})}function i(a){let b=(c=(c+1)%Number.MAX_VALUE).toString(),d=()=>h({type:"DISMISS_TOAST",toastId:b});return h({type:"ADD_TOAST",toast:{...a,id:b,open:!0,onOpenChange:a=>{a||d()}}}),{id:b,dismiss:d,update:a=>h({type:"UPDATE_TOAST",toast:{...a,id:b}})}}function j(){let[a,c]=b.useState(g);return b.useEffect(()=>(f.push(c),()=>{let a=f.indexOf(c);a>-1&&f.splice(a,1)}),[a]),{...a,toast:i,dismiss:a=>h({type:"DISMISS_TOAST",toastId:a})}}a.s(["toast",()=>i,"useToast",()=>j])},84391,a=>{"use strict";a.i(74281);var b=a.i(19345);let c="https://viaticos.davidzapata-dz051099.workers.dev";async function d(){throw Error("getAuthToken solo puede ser llamado en el cliente")}async function e(a,b={}){try{let e,f=await d();for(let d=0;d<3;d++)try{let d=await fetch(`${c}${a}`,{...b,headers:{"Content-Type":"application/json",Authorization:`Bearer ${f}`,...b.headers}}),e=await d.json();if(!d.ok){if(!0===e.success)return e;if(401===d.status)throw Error("Sesión expirada. Por favor, inicia sesión nuevamente.");throw Error(e.message||e.error||"Error en la solicitud")}if(!1===e.success&&e.error)throw Error(e.error||e.message||"Error en la solicitud");return e}catch(b){if(console.warn(`Intento ${d+1} fallido para ${a}:`,b),e=b,2===d)break;await new Promise(a=>setTimeout(a,500*(d+1)))}throw console.error("Network error in apiRequest after 3 attempts:",e,"URL:",`${c}${a}`),Error(`Error de conexi\xf3n: ${e.message||"No se pudo conectar con el servidor"}`)}catch(a){if(a instanceof Error&&(a.message.includes("Usuario no autenticado")||a.message.includes("Sesión expirada")))throw Error("Sesión expirada. Por favor, inicia sesión nuevamente.");throw a}}async function f(a){let e=await d(),f=await fetch(`${c}/api/viaticos`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:a});if(!f.ok)throw Error((await f.json().catch(()=>({message:"Error al subir viático"}))).message||"Error al subir viático");return(0,b.toast)({title:"Éxito",description:"Viático subido correctamente.",variant:"success"}),f.json()}async function g(){return e("/api/viaticos/mis-viaticos")}async function h(){return e("/api/viaticos/all")}async function i(){return e("/api/users/me",{method:"GET"})}async function j(){try{let a=await e("/api/users/me",{method:"GET"});if(a.success&&a.user)return a.user;return null}catch(a){return console.error("Error fetching my user:",a),null}}async function k(){return e("/api/users",{method:"GET"})}async function l(a,b){return e(`/api/users/${a}/role`,{method:"PUT",body:JSON.stringify({role:b})})}async function m(){let a=await d(),e=await fetch(`${c}/api/cleanup/anonymous`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!e.ok)throw Error((await e.json().catch(()=>({message:"Error ejecutando limpieza"}))).message||"Error ejecutando limpieza");return(0,b.toast)({title:"Éxito",description:"Limpieza de usuarios anónimos ejecutada correctamente.",variant:"success"}),e.json()}async function n(a,b){return e(`/api/users/${a}/status`,{method:"PUT",body:JSON.stringify({estado:b})})}async function o(a){return e("/api/users/close-day",{method:"POST",body:JSON.stringify({date:a})})}async function p(a){let e=await d(),f=await fetch(`${c}/api/users/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!f.ok)throw Error((await f.json().catch(()=>({message:"Error eliminando usuario"}))).message||"Error eliminando usuario");return(0,b.toast)({title:"Éxito",description:"Usuario eliminado correctamente.",variant:"success"}),f.json()}async function q(a,b){return e(`/api/viaticos/${a}`,{method:"PUT",body:JSON.stringify(b)})}async function r(a){return e(`/api/viaticos/${a}`,{method:"DELETE"})}async function s(a){return await d(),e("/api/push/subscribe",{method:"POST",body:JSON.stringify(a)})}async function t(){return fetch(`${c}/api/push/vapid-public-key`).then(a=>a.json())}async function u(a){return e("/api/push/unsubscribe",{method:"POST",body:JSON.stringify({endpoint:a})})}a.s(["apiRequest",()=>e,"cleanupAnonymousUsers",()=>m,"closeDay",()=>o,"deleteUser",()=>p,"deleteViatico",()=>r,"getAllUsers",()=>k,"getAllViaticos",()=>h,"getAuthToken",()=>d,"getCurrentUser",()=>i,"getMisViaticos",()=>g,"getMyUser",()=>j,"getVapidPublicKey",()=>t,"setUserRole",()=>l,"setUserStatus",()=>n,"subscribeToNotifications",()=>s,"unsubscribeFromNotifications",()=>u,"updateViatico",()=>q,"uploadViatico",()=>f])},11642,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(30485),a.i(74312);var d=a.i(33812),d=d,e=a.i(74281),f=a.i(84391);let g=(0,c.createContext)({user:null,appUser:null,signIn:async()=>({success:!1}),signUp:async()=>({success:!1}),signInWithMicrosoft:async()=>({success:!1}),signOut:async()=>({success:!1}),loading:!0});function h(){return(0,c.useContext)(g)}function i({children:h}){let[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(!0);async function o(b,c){await (0,e.initializeFirebase)();let{auth:f}=await a.A(76463);if(!f)return{success:!1,error:"Firebase Auth no está disponible"};try{let a=await (0,d.ac)(f,b,c);return{success:!0,user:a.user}}catch(a){return{success:!1,error:a.message}}}async function p(){await (0,e.initializeFirebase)();let{auth:b}=await a.A(76463);if(!b)return{success:!1,error:"Firebase Auth no está disponible. Verifica las variables de entorno."};try{let a=new d._("microsoft.com");a.addScope("openid"),a.addScope("profile"),a.addScope("email"),a.addScope("offline_access");let c=await (0,d.d)(b,a);return{success:!0,user:c.user}}catch(a){if("auth/popup-closed-by-user"===a.code)return{success:!1,error:"Inicio de sesión cancelado por el usuario"};return console.error("Error en signInWithMicrosoft:",a),{success:!1,error:a.message||"Error al iniciar sesión con Microsoft"}}}async function q(b,c){await (0,e.initializeFirebase)();let{auth:f}=await a.A(76463);if(!f)return{success:!1,error:"Firebase Auth no está disponible"};try{let a=await (0,d.ab)(f,b,c);return{success:!0,user:a.user}}catch(a){return{success:!1,error:a.message}}}async function r(){await (0,e.initializeFirebase)();let{auth:b}=await a.A(76463);if(!b)return{success:!1,error:"Firebase Auth no está disponible"};try{return await (0,d.D)(b),document.cookie="firebase-token=; path=/; max-age=0",{success:!0}}catch(a){return{success:!1,error:a.message}}}return(0,c.useEffect)(()=>{let b=()=>{};return(async()=>{await (0,e.initializeFirebase)();let{auth:c}=await a.A(76463);if(!c)return n(!1);try{await (0,d.t)(c,d.b)}catch(a){console.warn("No se pudo establecer persistencia local:",a.message||a)}try{await (0,d.k)(c)}catch(a){}b=(0,d.z)(c,async b=>{j(b),b?(b.getIdToken().then(a=>(document.cookie=`firebase-token=${a}; path=/; max-age=604800; SameSite=Lax; Secure`,(0,f.getMyUser)())).then(async b=>{if(b&&b.exists){if("inactivo"===b.estado){await c.signOut(),j(null),l(null);let b=(await a.A(27871)).default;await b.fire({title:"Cuenta Inactiva",text:"Tu cuenta ha sido desactivada por un administrador. Contacta a soporte para más información.",icon:"error",confirmButtonColor:"#ea580c"});return}l(b)}else try{let a=await (0,f.getMyUser)();a&&l(a)}catch(a){console.warn("Error auto-registrando usuario:",a)}}).catch(a=>{console.warn("Error fetching user data:",a),l(null)}),setInterval(async()=>{try{let a=c.currentUser;if(a){let b=await a.getIdToken(!0);document.cookie=`firebase-token=${b}; path=/; max-age=604800; SameSite=Lax; Secure`}}catch(a){console.warn("Error renovando token:",a.message||a)}},36e5)):(document.cookie="firebase-token=; path=/; max-age=0",l(null)),n(!1)})})(),()=>{try{b()}catch(a){}}},[]),(0,b.jsx)(g.Provider,{value:{user:i,appUser:k,signIn:o,signUp:q,signInWithMicrosoft:p,signOut:r,loading:m},children:h})}a.s(["AuthProvider",()=>i,"useAuth",()=>h],11642)},28094,a=>{"use strict";var b=a.i(72131);a.i(35112);var c=a.i(70121),d=a.i(87924),e=Symbol("radix.slottable");function f(a){return b.isValidElement(a)&&"function"==typeof a.type&&"__radixId"in a.type&&a.type.__radixId===e}var g=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((a,e)=>{var g,h;let i,j,k,l=(h=g=`Primitive.${e}`,(i=b.forwardRef((a,d)=>{let{children:e,...f}=a;if(b.isValidElement(e)){var g;let a,h,i=(g=e,(h=(a=Object.getOwnPropertyDescriptor(g.props,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?g.ref:(h=(a=Object.getOwnPropertyDescriptor(g,"ref")?.get)&&"isReactWarning"in a&&a.isReactWarning)?g.props.ref:g.props.ref||g.ref),j=function(a,b){let c={...b};for(let d in b){let e=a[d],f=b[d];/^on[A-Z]/.test(d)?e&&f?c[d]=(...a)=>{let b=f(...a);return e(...a),b}:e&&(c[d]=e):"style"===d?c[d]={...e,...f}:"className"===d&&(c[d]=[e,f].filter(Boolean).join(" "))}return{...a,...c}}(f,e.props);return e.type!==b.Fragment&&(j.ref=d?(0,c.composeRefs)(d,i):i),b.cloneElement(e,j)}return b.Children.count(e)>1?b.Children.only(null):null})).displayName=`${h}.SlotClone`,j=i,(k=b.forwardRef((a,c)=>{let{children:e,...g}=a,h=b.Children.toArray(e),i=h.find(f);if(i){let a=i.props.children,e=h.map(c=>c!==i?c:b.Children.count(a)>1?b.Children.only(null):b.isValidElement(a)?a.props.children:null);return(0,d.jsx)(j,{...g,ref:c,children:b.isValidElement(a)?b.cloneElement(a,void 0,e):null})}return(0,d.jsx)(j,{...g,ref:c,children:e})})).displayName=`${g}.Slot`,k),m=b.forwardRef((a,b)=>{let{asChild:c,...f}=a;return(0,d.jsx)(c?l:e,{...f,ref:b})});return m.displayName=`Primitive.${e}`,{...a,[e]:m}},{}),h=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),i=b.forwardRef((a,b)=>(0,d.jsx)(g.span,{...a,ref:b,style:{...h,...a.style}}));i.displayName="VisuallyHidden",a.s(["Root",()=>i,"VISUALLY_HIDDEN_STYLES",()=>h,"VisuallyHidden",()=>i],28094)}];

//# sourceMappingURL=_9fb9ec6a._.js.map