module.exports=[11642,a=>{"use strict";var b=a.i(87924),c=a.i(72131);a.i(30485);var d=a.i(70896),e=a.i(74281),f=a.i(84391);let g=(0,c.createContext)({user:null,appUser:null,signIn:async()=>({success:!1}),signUp:async()=>({success:!1}),signInWithMicrosoft:async()=>({success:!1}),signOut:async()=>({success:!1}),loading:!0});function h(){return(0,c.useContext)(g)}function i({children:h}){let[i,j]=(0,c.useState)(null),[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(!0);async function o(b,c){await (0,e.initializeFirebase)();let{auth:f}=await a.A(76463);if(!f)return{success:!1,error:"Firebase Auth no está disponible"};try{let a=await (0,d.signInWithEmailAndPassword)(f,b,c);return{success:!0,user:a.user}}catch(a){return{success:!1,error:a.message}}}async function p(){await (0,e.initializeFirebase)();let{auth:b}=await a.A(76463);if(!b)return{success:!1,error:"Firebase Auth no está disponible. Verifica las variables de entorno."};try{let c=new d.OAuthProvider("microsoft.com");c.addScope("openid"),c.addScope("profile"),c.addScope("email"),c.addScope("offline_access");let e=await (0,d.signInWithPopup)(b,c),{getAdditionalUserInfo:f}=await a.A(19135);if(f(e)?.isNewUser)try{let{createUserFolder:b}=await a.A(70218);await b()}catch(a){console.warn("No se pudo crear la carpeta para el nuevo usuario:",a.message||a)}return{success:!0,user:e.user}}catch(a){return console.error("Error en signInWithMicrosoft:",a),{success:!1,error:a.message||"Error al iniciar sesión con Microsoft"}}}async function q(b,c){await (0,e.initializeFirebase)();let{auth:g}=await a.A(76463);if(!g)return{success:!1,error:"Firebase Auth no está disponible"};try{let a=await (0,d.createUserWithEmailAndPassword)(g,b,c);try{await (0,f.createUserFolder)()}catch(a){console.warn("No se pudo crear la carpeta en OneDrive al registrar usuario:",a.message||a)}return{success:!0,user:a.user}}catch(a){return{success:!1,error:a.message}}}async function r(){await (0,e.initializeFirebase)();let{auth:b}=await a.A(76463);if(!b)return{success:!1,error:"Firebase Auth no está disponible"};try{return await (0,d.signOut)(b),document.cookie="firebase-token=; path=/; max-age=0",{success:!0}}catch(a){return{success:!1,error:a.message}}}return(0,c.useEffect)(()=>{let b=()=>{};return(async()=>{await (0,e.initializeFirebase)();let{auth:c}=await a.A(76463);if(!c)return n(!1);try{await (0,d.setPersistence)(c,d.browserLocalPersistence)}catch(a){console.warn("No se pudo establecer persistencia local:",a.message||a)}try{let b=await (0,d.getRedirectResult)(c);if(b){let{getAdditionalUserInfo:c}=await a.A(19135);if(c(b)?.isNewUser)try{let{createUserFolder:b}=await a.A(70218);await b()}catch(a){console.warn("No se pudo crear la carpeta para el nuevo usuario:",a.message||a)}}}catch(a){}b=(0,d.onAuthStateChanged)(c,async a=>{if(j(a),a)try{let b=await a.getIdToken();document.cookie=`firebase-token=${b}; path=/; max-age=604800; SameSite=Lax; Secure`;let d=await (0,f.getMyUser)();d&&l(d),setInterval(async()=>{try{let a=c.currentUser;if(a){let b=await a.getIdToken(!0);document.cookie=`firebase-token=${b}; path=/; max-age=604800; SameSite=Lax; Secure`}}catch(a){console.warn("Error renovando token:",a.message||a)}},36e5)}catch(a){console.warn("Error en onAuthStateChanged:",a.message||a),l(null)}else document.cookie="firebase-token=; path=/; max-age=0",l(null);n(!1)})})(),()=>{try{b()}catch(a){}}},[]),(0,b.jsx)(g.Provider,{value:{user:i,appUser:k,signIn:o,signUp:q,signInWithMicrosoft:p,signOut:r,loading:m},children:h})}a.s(["AuthProvider",()=>i,"useAuth",()=>h])},70896,a=>{"use strict";a.i(74312);var b=a.i(33812);a.s(["ActionCodeOperation",()=>b.A,"ActionCodeURL",()=>b.aj,"AuthCredential",()=>b.M,"AuthErrorCodes",()=>b.J,"EmailAuthCredential",()=>b.N,"EmailAuthProvider",()=>b.W,"FacebookAuthProvider",()=>b.X,"FactorId",()=>b.F,"GithubAuthProvider",()=>b.Z,"GoogleAuthProvider",()=>b.Y,"OAuthCredential",()=>b.Q,"OAuthProvider",()=>b._,"OperationType",()=>b.O,"PhoneAuthCredential",()=>b.U,"PhoneAuthProvider",()=>b.P,"PhoneMultiFactorGenerator",()=>b.n,"ProviderId",()=>b.q,"RecaptchaVerifier",()=>b.R,"SAMLAuthProvider",()=>b.$,"SignInMethod",()=>b.S,"TotpMultiFactorGenerator",()=>b.T,"TotpSecret",()=>b.o,"TwitterAuthProvider",()=>b.a0,"applyActionCode",()=>b.a8,"beforeAuthStateChanged",()=>b.y,"browserCookiePersistence",()=>b.a,"browserLocalPersistence",()=>b.b,"browserPopupRedirectResolver",()=>b.m,"browserSessionPersistence",()=>b.c,"checkActionCode",()=>b.a9,"confirmPasswordReset",()=>b.a7,"connectAuthEmulator",()=>b.L,"createUserWithEmailAndPassword",()=>b.ab,"debugErrorMap",()=>b.H,"deleteUser",()=>b.G,"fetchSignInMethodsForEmail",()=>b.ag,"getAdditionalUserInfo",()=>b.ar,"getAuth",()=>b.p,"getIdToken",()=>b.ao,"getIdTokenResult",()=>b.ap,"getMultiFactorResolver",()=>b.at,"getRedirectResult",()=>b.k,"inMemoryPersistence",()=>b.V,"indexedDBLocalPersistence",()=>b.i,"initializeAuth",()=>b.K,"initializeRecaptchaConfig",()=>b.v,"isSignInWithEmailLink",()=>b.ae,"linkWithCredential",()=>b.a3,"linkWithPhoneNumber",()=>b.l,"linkWithPopup",()=>b.e,"linkWithRedirect",()=>b.h,"multiFactor",()=>b.au,"onAuthStateChanged",()=>b.z,"onIdTokenChanged",()=>b.x,"parseActionCodeURL",()=>b.ak,"prodErrorMap",()=>b.I,"reauthenticateWithCredential",()=>b.a4,"reauthenticateWithPhoneNumber",()=>b.r,"reauthenticateWithPopup",()=>b.f,"reauthenticateWithRedirect",()=>b.j,"reload",()=>b.as,"revokeAccessToken",()=>b.E,"sendEmailVerification",()=>b.ah,"sendPasswordResetEmail",()=>b.a6,"sendSignInLinkToEmail",()=>b.ad,"setPersistence",()=>b.t,"signInAnonymously",()=>b.a1,"signInWithCredential",()=>b.a2,"signInWithCustomToken",()=>b.a5,"signInWithEmailAndPassword",()=>b.ac,"signInWithEmailLink",()=>b.af,"signInWithPhoneNumber",()=>b.s,"signInWithPopup",()=>b.d,"signInWithRedirect",()=>b.g,"signOut",()=>b.D,"unlink",()=>b.aq,"updateCurrentUser",()=>b.C,"updateEmail",()=>b.am,"updatePassword",()=>b.an,"updatePhoneNumber",()=>b.u,"updateProfile",()=>b.al,"useDeviceLanguage",()=>b.B,"validatePassword",()=>b.w,"verifyBeforeUpdateEmail",()=>b.ai,"verifyPasswordResetCode",()=>b.aa])},74281,a=>{"use strict";async function b(){return null}(0,a.i(88156).registerVersion)("firebase","12.6.0","app"),a.i(30485),a.s(["auth",()=>null,"default",0,null,"initializeFirebase",()=>b],74281)},19345,a=>{"use strict";var b=a.i(72131);let c=0,d=new Map,e=a=>{if(d.has(a))return;let b=setTimeout(()=>{d.delete(a),h({type:"REMOVE_TOAST",toastId:a})},1e6);d.set(a,b)},f=[],g={toasts:[]};function h(a){g=((a,b)=>{switch(b.type){case"ADD_TOAST":return{...a,toasts:[b.toast,...a.toasts].slice(0,1)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(a=>a.id===b.toast.id?{...a,...b.toast}:a)};case"DISMISS_TOAST":{let{toastId:c}=b;return c?e(c):a.toasts.forEach(a=>{e(a.id)}),{...a,toasts:a.toasts.map(a=>a.id===c||void 0===c?{...a,open:!1}:a)}}case"REMOVE_TOAST":if(void 0===b.toastId)return{...a,toasts:[]};return{...a,toasts:a.toasts.filter(a=>a.id!==b.toastId)}}})(g,a),f.forEach(a=>{a(g)})}function i(a){let b=(c=(c+1)%Number.MAX_VALUE).toString(),d=()=>h({type:"DISMISS_TOAST",toastId:b});return h({type:"ADD_TOAST",toast:{...a,id:b,open:!0,onOpenChange:a=>{a||d()}}}),{id:b,dismiss:d,update:a=>h({type:"UPDATE_TOAST",toast:{...a,id:b}})}}function j(){let[a,c]=b.useState(g);return b.useEffect(()=>(f.push(c),()=>{let a=f.indexOf(c);a>-1&&f.splice(a,1)}),[a]),{...a,toast:i,dismiss:a=>h({type:"DISMISS_TOAST",toastId:a})}}a.s(["toast",()=>i,"useToast",()=>j])},84391,a=>{"use strict";a.i(74281);var b=a.i(19345);let c="https://viaticos.davidzapata-dz051099.workers.dev";async function d(){throw Error("getAuthToken solo puede ser llamado en el cliente")}async function e(a,f={}){try{let e=await d(),g=await fetch(`${c}${a}`,{...f,headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`,...f.headers}}),h=await g.json();if(!g.ok){if(!0===h.success)return h;if(401===g.status)throw Error("Sesión expirada. Por favor, inicia sesión nuevamente.");throw Error(h.message||h.error||"Error en la solicitud")}if(!1===h.success&&h.error)throw Error(h.error||h.message||"Error en la solicitud");let i=f.method?.toUpperCase();return("POST"===i||"PUT"===i||"DELETE"===i)&&(0,b.toast)({title:"Éxito",description:"Datos actualizados correctamente.",variant:"success"}),h}catch(a){if(a instanceof Error&&a.message.includes("Usuario no autenticado"))throw Error("Sesión expirada. Por favor, inicia sesión nuevamente.");throw a}}async function f(a){let e=await d(),f=await fetch(`${c}/api/viaticos`,{method:"POST",headers:{Authorization:`Bearer ${e}`},body:a});if(!f.ok)throw Error((await f.json().catch(()=>({message:"Error al subir viático"}))).message||"Error al subir viático");return(0,b.toast)({title:"Éxito",description:"Viático subido correctamente.",variant:"success"}),f.json()}async function g(){return e("/api/viaticos/today-summary",{method:"GET"})}async function h(){return e("/api/viaticos/mis-viaticos")}async function i(){return e("/api/viaticos/all")}async function j(a){return e(`/api/viaticos/user/${a}`)}async function k(a){return e(`/api/viaticos/fecha/${a}`)}async function l(){return e("/api/users",{method:"POST",body:JSON.stringify({})})}async function m(){return e("/api/users/me",{method:"GET"})}async function n(){try{let a=await e("/api/users/me",{method:"GET"});if(a.success&&a.user)return a.user;return null}catch(a){return console.error("Error fetching my user:",a),null}}async function o(){return e("/api/users",{method:"GET"})}async function p(a,b){return e(`/api/users/${a}/role`,{method:"PUT",body:JSON.stringify({role:b})})}async function q(){return e("/api/onedrive/structure",{method:"GET"})}async function r(){return e("/api/onedrive/verify-structure",{method:"GET"})}async function s(){return e("/api/onedrive/ensure",{method:"POST"})}async function t(a){let e=await d(),f=await fetch(`${c}/api/onedrive/ensure-user/${a}`,{method:"POST",headers:{Authorization:`Bearer ${e}`}});if(!f.ok)throw Error((await f.json().catch(()=>({message:"Error asegurando carpeta"}))).message||"Error asegurando carpeta");return(0,b.toast)({title:"Éxito",description:"Carpeta de usuario asegurada correctamente.",variant:"success"}),f.json()}async function u(){let a=await d(),e=await fetch(`${c}/api/onedrive/ensure-me`,{method:"POST",headers:{Authorization:`Bearer ${a}`}});if(!e.ok)throw Error((await e.json().catch(()=>({message:"Error asegurando carpeta"}))).message||"Error asegurando carpeta");return(0,b.toast)({title:"Éxito",description:"Tu carpeta de OneDrive ha sido asegurada.",variant:"success"}),e.json()}async function v(){let a=await d(),e=await fetch(`${c}/api/migrate`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!e.ok)throw Error((await e.json().catch(()=>({message:"Error ejecutando migración"}))).message||"Error ejecutando migración");return(0,b.toast)({title:"Éxito",description:"Migración ejecutada correctamente.",variant:"success"}),e.json()}async function w(){let a=await d(),e=await fetch(`${c}/api/cleanup/anonymous`,{method:"POST",headers:{Authorization:`Bearer ${a}`,"Content-Type":"application/json"}});if(!e.ok)throw Error((await e.json().catch(()=>({message:"Error ejecutando limpieza"}))).message||"Error ejecutando limpieza");return(0,b.toast)({title:"Éxito",description:"Limpieza de usuarios anónimos ejecutada correctamente.",variant:"success"}),e.json()}async function x(a,b){return e(`/api/users/${a}/status`,{method:"PUT",body:JSON.stringify({estado:b})})}async function y(a,b){return e(`/api/users/${a}/create-folder`,{method:"PUT",body:JSON.stringify({crear_carpeta:b})})}async function z(a){let e=await d(),f=await fetch(`${c}/api/users/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!f.ok)throw Error((await f.json().catch(()=>({message:"Error eliminando usuario"}))).message||"Error eliminando usuario");return(0,b.toast)({title:"Éxito",description:"Usuario eliminado correctamente.",variant:"success"}),f.json()}async function A(a){let e=await d(),f=await fetch(`${c}/api/viaticos/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"}});if(!f.ok)throw Error((await f.json().catch(()=>({message:"Error eliminando viático"}))).message||"Error eliminando viático");return(0,b.toast)({title:"Éxito",description:"Viático eliminado correctamente.",variant:"success"}),f.json()}a.s(["cleanupAnonymousUsers",()=>w,"createUserFolder",()=>l,"deleteUser",()=>z,"deleteViatico",()=>A,"ejecutarMigracion",()=>v,"ensureMyOneDriveFolder",()=>u,"ensureOneDriveFolderForUser",()=>t,"ensureOneDriveFolders",()=>s,"getAllUsers",()=>o,"getAllViaticos",()=>i,"getCurrentUser",()=>m,"getMisViaticos",()=>h,"getMyUser",()=>n,"getOneDriveStructure",()=>q,"getTodaySummary",()=>g,"getViaticosByDate",()=>k,"getViaticosByUser",()=>j,"setUserCreateFolder",()=>y,"setUserRole",()=>p,"setUserStatus",()=>x,"uploadViatico",()=>f,"verifyOneDriveStructure",()=>r])}];

//# sourceMappingURL=_d451bac4._.js.map