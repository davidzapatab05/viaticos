module.exports=[21705,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(515),e=a.i(19120),f=a.i(50944),g=a.i(11642),h=a.i(84391),i=a.i(91119),j=a.i(99570),k=a.i(66718),l=a.i(70430),m=a.i(29246),n=a.i(80701),o=a.i(24348),p=a.i(86304),q=a.i(14574),r=a.i(85259),s=a.i(70106);let t=(0,s.default)("file-check",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]),u=(0,s.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var v=a.i(13513),w=a.i(33508),x=a.i(96221);let y=(0,s.default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var z=a.i(67453),A=a.i(97063),B=a.i(4720);let C=(0,s.default)("refresh-ccw",[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]]),D=(0,s.default)("calendar-days",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]]);var E=a.i(1610),F=a.i(64549),G=a.i(81458),H=a.i(14804);function I(){let{appUser:s,loading:I}=(0,g.useAuth)();(0,f.useRouter)();let{activeDate:J,activeDateDisplay:K,timeLeft:L,isGracePeriod:M}=(0,H.useViaticoDeadline)(),[N,O]=(0,c.useState)(J?J.toISOString().split("T")[0]:"");(0,c.useEffect)(()=>{J&&O((0,d.format)(J,"yyyy-MM-dd"))},[J]);let[P,Q]=(0,c.useState)([]),[R,S]=(0,c.useState)([]),[T,U]=(0,c.useState)(""),[V,W]=(0,c.useState)(""),[X,Y]=(0,c.useState)(""),[Z,$]=(0,c.useState)(""),[_,aa]=(0,c.useState)(""),[ab,ac]=(0,c.useState)(""),[ad,ae]=(0,c.useState)("otro"),[af,ag]=(0,c.useState)(!1),[ah,ai]=(0,c.useState)(""),[aj,ak]=(0,c.useState)(!1),[al,am]=(0,c.useState)(!1),[an,ao]=(0,c.useState)("environment"),ap=(0,c.useRef)(null),aq=(0,c.useRef)(null),ar=(0,c.useRef)(null),[as,at]=(0,c.useState)(0);(0,c.useEffect)(()=>{N&&a.A(70218).then(({getMisViaticos:a})=>{a().then(a=>{a.success&&Array.isArray(a.viaticos)&&at(a.viaticos.filter(a=>a.fecha===N).length)}).catch(console.error)})},[N,aj]);let au=()=>{ar.current&&(ar.current.getTracks().forEach(a=>a.stop()),ar.current=null),aq.current&&(aq.current.srcObject=null)};(0,c.useEffect)(()=>(al?(au(),navigator.mediaDevices.getUserMedia({video:{facingMode:an}}).then(a=>{ar.current=a,aq.current&&(aq.current.srcObject=a)}).catch(a=>{console.error("Error accediendo a la cÃ¡mara:",a),ai("No se pudo acceder a la cÃ¡mara. AsegÃºrate de dar permisos."),"OverconstrainedError"===a.name?navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{ar.current=a,aq.current&&(aq.current.srcObject=a)}).catch(a=>{console.error("Fallback camera error:",a),am(!1)}):am(!1)})):au(),()=>{au()}),[al,an]);let av=async a=>{if(a.preventDefault(),0===P.length||!T||!V||""===V.trim())return void ai("Por favor completa todos los campos obligatorios: foto, monto y descripciÃ³n.");ag(!0),ai(""),ak(!1);try{let a=new FormData;P.forEach(b=>{a.append("foto",b)}),a.append("monto",T),a.append("descripcion",V),a.append("tipo",ad),a.append("para",X),a.append("tipo_comprobante",Z),_&&a.append("numero_documento",_),ab&&a.append("numero_comprobante",ab),ab&&a.append("numero_comprobante",ab),a.append("fecha_manual",N),a.append("createTxt","1"),await (0,h.uploadViatico)(a),ak(!0),aw(),setTimeout(()=>{ak(!1)},3e3)}catch(a){ai(a.message||"Error al subir el viÃ¡tico")}finally{ag(!1)}},aw=()=>{Q([]),S([]),U(""),W(""),Y(""),$(""),aa(""),ac(""),ap.current&&(ap.current.value="")};return I||!s?(0,b.jsx)(F.default,{children:(0,b.jsx)(E.default,{children:(0,b.jsx)("div",{className:"max-w-5xl mx-auto space-y-6",children:(0,b.jsx)(i.Card,{children:(0,b.jsx)(i.CardContent,{className:"p-6 sm:p-20",children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center text-center space-y-4",children:[(0,b.jsx)(x.Loader2,{className:"h-12 w-12 animate-spin text-primary"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Cargando..."})]})})})})})}):(0,b.jsx)(F.default,{children:(0,b.jsxs)(E.default,{children:[(0,b.jsx)(r.TooltipProvider,{children:(0,b.jsxs)("div",{className:"max-w-5xl mx-auto space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Nuevo ViÃ¡tico"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Registra un nuevo comprobante con su foto o PDF"})]}),(0,b.jsx)(i.Card,{className:`border-2 ${M?"border-orange-500 bg-orange-950/40":"border-primary/20 bg-primary/5"}`,children:(0,b.jsxs)(i.CardContent,{className:"pt-6 flex flex-col sm:flex-row items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex items-center gap-4",children:[(0,b.jsx)("div",{className:`p-3 rounded-full ${M?"bg-orange-900/40":"bg-primary/10"}`,children:(0,b.jsx)(D,{className:`h-8 w-8 ${M?"text-orange-600":"text-primary"}`})}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm font-medium text-muted-foreground",children:"Fecha de Registro Activa"}),s?.role==="admin"||s?.role==="super_admin"?(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsx)(G.DatePicker,{date:N?new Date(N+"T12:00:00"):void 0,onSelect:a=>{a&&O(a.toISOString().split("T")[0])}})}):(0,b.jsx)("div",{className:`flex items-center min-h-10 h-auto px-3 py-2 border rounded-md ${M?"bg-orange-600 border-orange-600":"bg-background"}`,children:(0,b.jsx)("span",{className:`text-sm text-center sm:text-left ${M?"text-white":"text-primary"}`,children:J?(0,d.format)(J,"EEEE d 'de' MMMM 'de' yyyy",{locale:e.es}):K})})]})]}),(0,b.jsx)("div",{className:"flex flex-col items-center sm:items-end gap-2 w-full sm:w-auto",children:M&&(0,b.jsx)("p",{className:"text-xs text-orange-600 font-medium text-center sm:text-right max-w-[250px]",children:"Tienes hasta las 10:00 AM para registrar viÃ¡ticos de ayer."})})]})}),(0,b.jsx)("form",{onSubmit:av,className:"space-y-6",children:(0,b.jsxs)(i.Card,{children:[(0,b.jsxs)(i.CardHeader,{children:[(0,b.jsx)(i.CardTitle,{children:"InformaciÃ³n del Comprobante"}),(0,b.jsx)(i.CardDescription,{children:"Sube tus comprobantes y completa los datos"})]}),(0,b.jsxs)(i.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(l.Label,{children:"Comprobantes"}),(0,b.jsxs)(r.Tooltip,{children:[(0,b.jsx)(r.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(p.Badge,{variant:"outline",className:"text-xs",children:[(0,b.jsx)(A.Info,{className:"h-3 w-3 mr-1"}),"Formatos: JPG, PNG, WEBP, PDF"]})}),(0,b.jsx)(r.TooltipContent,{children:(0,b.jsx)("p",{children:"El tamaÃ±o mÃ¡ximo es de 10MB por archivo"})})]})]}),(0,b.jsx)("input",{ref:ap,type:"file",accept:"image/*,application/pdf",onChange:a=>{let b=a.target.files;if(!b)return;let c=Array.from(b),d=[...P],e=[...R];for(let a of c){if(a.size>0xa00000){ai(`El archivo ${a.name} es demasiado grande. M\xe1ximo 10MB.`);continue}d.push(a);let b="application/pdf"===a.type,c=new FileReader;c.onload=c=>{e.push({url:c.target?.result,isPdf:b,name:a.name}),S([...e])},c.readAsDataURL(a)}Q(d),ai(""),ap.current&&(ap.current.value="")},className:"hidden",multiple:!0}),R.length>0?(0,b.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:[R.map((a,c)=>(0,b.jsxs)("div",{className:"relative group w-full",children:[(0,b.jsx)("div",{className:"rounded-lg border overflow-hidden aspect-square flex items-center justify-center bg-muted",children:a.isPdf?(0,b.jsxs)("div",{className:"p-4 flex flex-col items-center justify-center text-center",children:[(0,b.jsx)(B.FileText,{className:"w-10 h-10 text-primary"}),(0,b.jsx)("p",{className:"mt-2 text-xs font-medium break-all max-w-xs",children:a.name}),(0,b.jsx)("a",{href:a.url,target:"_blank",rel:"noreferrer",className:"mt-2",children:(0,b.jsx)(j.Button,{variant:"outline",size:"sm",children:"Ver"})})]}):(0,b.jsx)("img",{src:a.url,alt:`Vista previa ${c+1}`,className:"w-full h-full object-cover"})}),(0,b.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsxs)(r.Tooltip,{children:[(0,b.jsx)(r.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(j.Button,{type:"button",variant:"destructive",size:"icon",onClick:()=>{Q(P.filter((a,b)=>b!==c)),S(R.filter((a,b)=>b!==c))},children:(0,b.jsx)(w.X,{className:"h-4 w-4"})})}),(0,b.jsx)(r.TooltipContent,{children:(0,b.jsx)("p",{children:"Eliminar archivo"})})]})})]},c)),(0,b.jsxs)("div",{className:"border-2 border-dashed rounded-lg flex flex-col items-center justify-center text-center cursor-pointer hover:bg-muted/50 transition-colors aspect-square",onClick:()=>ap.current?.click(),children:[(0,b.jsx)(u,{className:"w-8 h-8 text-primary"}),(0,b.jsx)("p",{className:"mt-2 text-sm font-semibold",children:"AÃ±adir mÃ¡s"})]})]}):(0,b.jsxs)("div",{className:"border-2 border-dashed rounded-lg flex flex-col items-center justify-center p-6 sm:p-10 text-center cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>ap.current?.click(),children:[(0,b.jsx)("div",{className:"mx-auto w-12 h-12 sm:w-16 sm:h-16 rounded-lg bg-primary/10 flex items-center justify-center mb-4",children:(0,b.jsx)(u,{className:"w-6 h-6 sm:w-8 sm:h-8 text-primary"})}),(0,b.jsx)("p",{className:"mt-2 sm:mt-4 font-semibold text-sm sm:text-base",children:"Seleccionar Archivos"}),(0,b.jsx)("p",{className:"text-xs sm:text-sm text-muted-foreground mt-1 sm:mt-2",children:"o arrastra y suelta aquÃ­"}),(0,b.jsxs)("div",{className:"mt-4 sm:mt-6 flex items-center justify-center gap-2 flex-wrap",children:[(0,b.jsx)(p.Badge,{variant:"outline",className:"text-[10px] sm:text-xs",children:"JPG"}),(0,b.jsx)(p.Badge,{variant:"outline",className:"text-[10px] sm:text-xs",children:"PNG"}),(0,b.jsx)(p.Badge,{variant:"outline",className:"text-[10px] sm:text-xs",children:"WEBP"}),(0,b.jsx)(p.Badge,{variant:"outline",className:"text-[10px] sm:text-xs",children:"PDF"})]}),(0,b.jsx)("p",{className:"text-[10px] sm:text-xs text-muted-foreground mt-2 sm:mt-4",children:"MÃ¡ximo 10MB por archivo"})]}),(0,b.jsxs)(j.Button,{type:"button",variant:"outline",className:"w-full",onClick:()=>{am(!0),ao("environment")},children:[(0,b.jsx)(v.Camera,{className:"h-4 w-4 mr-2"}),"Tomar y AÃ±adir Foto"]})]}),(0,b.jsxs)("div",{className:"space-y-6 pt-6 border-t",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"para",children:"Para *"}),(0,b.jsxs)(n.Select,{value:X,onValueChange:Y,required:!0,children:[(0,b.jsx)(n.SelectTrigger,{id:"para",children:(0,b.jsx)(n.SelectValue,{placeholder:"Selecciona una opciÃ³n"})}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"EMPRESA",children:"ðŸ¢ Empresa"}),(0,b.jsx)(n.SelectItem,{value:"PERSONAL",children:"ðŸ‘¤ Personal"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"tipo_comprobante",children:"Tipo de Comprobante *"}),(0,b.jsxs)(n.Select,{value:Z,onValueChange:$,required:!0,children:[(0,b.jsx)(n.SelectTrigger,{id:"tipo_comprobante",children:(0,b.jsx)(n.SelectValue,{placeholder:"Selecciona un tipo"})}),(0,b.jsxs)(n.SelectContent,{children:[(0,b.jsx)(n.SelectItem,{value:"FACTURA",children:"ðŸ§¾ Factura"}),(0,b.jsx)(n.SelectItem,{value:"BOLETA",children:"ðŸ§¾ Boleta"}),(0,b.jsx)(n.SelectItem,{value:"RECIBO POR HONORARIO",children:"ðŸ“„ Recibo por Honorario"}),(0,b.jsx)(n.SelectItem,{value:"SIN COMPROBANTE",children:"âŒ Sin Comprobante"})]})]})]})]}),Z&&"SIN COMPROBANTE"!==Z&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"numero_documento",children:"BOLETA"===Z?"NÃºmero de DNI":"NÃºmero de RUC"}),(0,b.jsx)(k.Input,{id:"numero_documento",type:"text",value:_,onChange:a=>aa(a.target.value),placeholder:"BOLETA"===Z?"Ej: 12345678":"Ej: 20123456789"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"que_sustenta",children:"QuÃ© Sustenta"}),(0,b.jsx)(k.Input,{id:"que_sustenta",type:"text",value:"VIATICO",disabled:!0,className:"bg-muted"})]}),Z&&"SIN COMPROBANTE"!==Z&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"numero_comprobante",children:"NÃºmero de Comprobante"}),(0,b.jsx)(k.Input,{id:"numero_comprobante",type:"text",value:ab,onChange:a=>ac(a.target.value),placeholder:"Ej: 001-12345"})]})]}),(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"monto",children:"Monto (S/) *"}),(0,b.jsx)(k.Input,{id:"monto",type:"number",step:"0.01",min:"0",value:T,onChange:a=>U(a.target.value),required:!0,placeholder:"0.00"})]})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(l.Label,{htmlFor:"descripcion",children:"DescripciÃ³n *"}),(0,b.jsx)(m.Textarea,{id:"descripcion",value:V,onChange:a=>W(a.target.value),required:!0,placeholder:"Ej: Almuerzo con cliente, taxi al aeropuerto, etc.",rows:4})]})]}),ah&&(0,b.jsxs)(o.Alert,{variant:"destructive",children:[(0,b.jsx)(y,{className:"h-4 w-4"}),(0,b.jsx)(o.AlertTitle,{children:"Error"}),(0,b.jsx)(o.AlertDescription,{children:ah})]}),aj&&(0,b.jsxs)(o.Alert,{children:[(0,b.jsx)(z.CheckCircle2,{className:"h-4 w-4"}),(0,b.jsx)(o.AlertTitle,{children:"Ã‰xito"}),(0,b.jsx)(o.AlertDescription,{children:"ViÃ¡tico registrado correctamente. Puedes registrar otro."})]})]}),(0,b.jsx)(i.CardFooter,{className:"flex justify-end",children:(0,b.jsx)(j.Button,{type:"submit",size:"lg",disabled:af,className:"min-w-[200px]",children:af?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(x.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Registrando..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(t,{className:"mr-2 h-4 w-4"}),"Registrar ViÃ¡tico"]})})})]})}),(0,b.jsx)(q.Dialog,{open:al,onOpenChange:am,children:(0,b.jsxs)(q.DialogContent,{className:"max-w-4xl",children:[(0,b.jsxs)(q.DialogHeader,{children:[(0,b.jsx)(q.DialogTitle,{children:"Tomar Foto"}),(0,b.jsx)(q.DialogDescription,{children:"Captura una foto de tu comprobante usando la cÃ¡mara"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"relative rounded-lg overflow-hidden bg-black",children:[(0,b.jsx)("video",{ref:aq,id:"video",autoPlay:!0,playsInline:!0,className:"w-full rounded-lg"}),(0,b.jsx)(j.Button,{variant:"secondary",size:"icon",className:"absolute top-4 right-4 rounded-full bg-black/50 hover:bg-black/70 text-white border-none",onClick:()=>{ao(a=>"user"===a?"environment":"user")},children:(0,b.jsx)(C,{className:"h-5 w-5"})})]}),(0,b.jsx)("canvas",{id:"canvas",style:{display:"none"}}),(0,b.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,b.jsx)(j.Button,{variant:"outline",onClick:()=>am(!1),children:"Cancelar"}),(0,b.jsxs)(j.Button,{onClick:()=>{let a=aq.current,b=document.getElementById("canvas");if(!a||!b)return;let c=b.getContext("2d");c&&(b.width=a.videoWidth,b.height=a.videoHeight,c.drawImage(a,0,0),b.toBlob(a=>{if(a){let b=new File([a],`foto-${Date.now()}.jpg`,{type:"image/jpeg"});Q([...P,b]),S([...R,{url:URL.createObjectURL(a),isPdf:!1,name:b.name}]),am(!1)}},"image/jpeg",.8))},children:[(0,b.jsx)(v.Camera,{className:"h-4 w-4 mr-2"}),"Capturar Foto"]})]})]})]})})]})}),af&&(0,b.jsx)("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,b.jsx)(x.Loader2,{className:"h-12 w-12 animate-spin text-primary"}),(0,b.jsx)("p",{className:"text-lg font-medium text-foreground",children:"Registrando viÃ¡tico..."})]})})]})})}a.s(["default",()=>I],21705)}];

//# sourceMappingURL=src_app_nuevo-viatico_page_tsx_9c6f221b._.js.map