module.exports=[21705,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(11642),f=a.i(84391),g=a.i(91119),h=a.i(99570),i=a.i(68114);let j=c.forwardRef(({className:a,type:c,...d},e)=>(0,b.jsx)("input",{type:c,className:(0,i.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:e,...d}));j.displayName="Input";var k=a.i(30553),l=c.forwardRef((a,c)=>(0,b.jsx)(k.Primitive.label,{...a,ref:c,onMouseDown:b=>{b.target.closest("button, input, select, textarea")||(a.onMouseDown?.(b),!b.defaultPrevented&&b.detail>1&&b.preventDefault())}}));l.displayName="Label";let m=(0,a.i(187).cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),n=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(l,{ref:d,className:(0,i.cn)(m(),a),...c}));n.displayName=l.displayName;let o=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)("textarea",{className:(0,i.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:d,...c}));o.displayName="Textarea";var p=a.i(80701),q=a.i(24348),r=a.i(86304),s=a.i(63658),t=a.i(97942),u=a.i(33508);let v=t.Root;t.Trigger;let w=t.Portal;t.Close;let x=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(t.Overlay,{ref:d,className:(0,i.cn)("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...c}));x.displayName=t.Overlay.displayName;let y=c.forwardRef(({className:a,children:c,...d},e)=>(0,b.jsxs)(w,{children:[(0,b.jsx)(x,{}),(0,b.jsxs)(t.Content,{ref:e,className:(0,i.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] rounded-lg",a),...d,children:[c,(0,b.jsxs)(t.Close,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[(0,b.jsx)(u.X,{className:"h-4 w-4"}),(0,b.jsx)("span",{className:"sr-only",children:"Close"})]})]})]}));y.displayName=t.Content.displayName;let z=({className:a,...c})=>(0,b.jsx)("div",{className:(0,i.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...c});z.displayName="DialogHeader";let A=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(t.Title,{ref:d,className:(0,i.cn)("text-lg font-semibold leading-none tracking-tight",a),...c}));A.displayName=t.Title.displayName;let B=c.forwardRef(({className:a,...c},d)=>(0,b.jsx)(t.Description,{ref:d,className:(0,i.cn)("text-sm text-muted-foreground",a),...c}));B.displayName=t.Description.displayName;var C=a.i(85259),D=a.i(70106);let E=(0,D.default)("file-check",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]),F=(0,D.default)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]]);var G=a.i(13513),H=a.i(96221);let I=(0,D.default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);var J=a.i(67453),K=a.i(97063),L=a.i(4720),M=a.i(29908),N=a.i(64549);function O(){let{appUser:a,loading:i}=(0,e.useAuth)(),k=(0,d.useRouter)(),[l,m]=(0,c.useState)([]),[t,w]=(0,c.useState)([]),[x,D]=(0,c.useState)(""),[O,P]=(0,c.useState)(""),[Q,R]=(0,c.useState)("otro"),[S,T]=(0,c.useState)(!0),[U,V]=(0,c.useState)(!1),[W,X]=(0,c.useState)(""),[Y,Z]=(0,c.useState)(!1),[$,_]=(0,c.useState)(!1),aa=(0,c.useRef)(null);(0,c.useEffect)(()=>{i||!a||a.crear_carpeta||k.push("/dashboard")},[a,i,k]),(0,c.useEffect)(()=>{if($)navigator.mediaDevices.getUserMedia({video:!0}).then(a=>{let b=document.getElementById("video");b&&(b.srcObject=a)}).catch(a=>{console.error("Error accediendo a la cÃ¡mara:",a),X("No se pudo acceder a la cÃ¡mara"),_(!1)});else{let a=document.getElementById("video");a&&a.srcObject&&a.srcObject.getTracks().forEach(a=>a.stop())}},[$]);let ab=async a=>{if(a.preventDefault(),0===l.length||!x||!O)return void X("Por favor completa todos los campos y sube al menos un archivo.");V(!0),X(""),Z(!1);try{let a=new FormData;l.forEach(b=>{a.append("foto",b)}),a.append("monto",x),a.append("descripcion",O),a.append("tipo",Q),a.append("createTxt",S?"1":"0"),await (0,f.uploadViatico)(a),Z(!0),setTimeout(()=>{k.push("/mis-viaticos")},2e3)}catch(a){X(a.message||"Error al subir el viÃ¡tico")}finally{V(!1)}};return i||!a?(0,b.jsx)(N.default,{children:(0,b.jsx)(M.default,{children:(0,b.jsx)("div",{className:"max-w-5xl mx-auto space-y-6",children:(0,b.jsx)(g.Card,{children:(0,b.jsx)(g.CardContent,{className:"p-20",children:(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center text-center space-y-4",children:[(0,b.jsx)(H.Loader2,{className:"h-12 w-12 animate-spin text-primary"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Cargando..."})]})})})})})}):a.crear_carpeta?(0,b.jsx)(N.default,{children:(0,b.jsx)(M.default,{children:(0,b.jsx)(C.TooltipProvider,{children:(0,b.jsxs)("div",{className:"max-w-5xl mx-auto space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"Nuevo ViÃ¡tico"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"Registra un nuevo comprobante con su foto o PDF"})]}),(0,b.jsx)("form",{onSubmit:ab,className:"space-y-6",children:(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"InformaciÃ³n del Comprobante"}),(0,b.jsx)(g.CardDescription,{children:"Sube tus comprobantes y completa los datos"})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(n,{children:"Comprobantes"}),(0,b.jsxs)(C.Tooltip,{children:[(0,b.jsx)(C.TooltipTrigger,{asChild:!0,children:(0,b.jsxs)(r.Badge,{variant:"outline",className:"text-xs",children:[(0,b.jsx)(K.Info,{className:"h-3 w-3 mr-1"}),"Formatos: JPG, PNG, WEBP, PDF"]})}),(0,b.jsx)(C.TooltipContent,{children:(0,b.jsx)("p",{children:"El tamaÃ±o mÃ¡ximo es de 10MB por archivo"})})]})]}),(0,b.jsx)("input",{ref:aa,type:"file",accept:"image/*,application/pdf",onChange:a=>{let b=a.target.files;if(!b)return;let c=Array.from(b),d=[...l],e=[...t];for(let a of c){if(a.size>0xa00000){X(`El archivo ${a.name} es demasiado grande. M\xe1ximo 10MB.`);continue}d.push(a);let b="application/pdf"===a.type,c=new FileReader;c.onload=c=>{e.push({url:c.target?.result,isPdf:b,name:a.name}),w([...e])},c.readAsDataURL(a)}m(d),X(""),aa.current&&(aa.current.value="")},className:"hidden",multiple:!0}),t.length>0?(0,b.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:[t.map((a,c)=>(0,b.jsxs)("div",{className:"relative group w-full",children:[(0,b.jsx)("div",{className:"rounded-lg border overflow-hidden aspect-square flex items-center justify-center bg-muted",children:a.isPdf?(0,b.jsxs)("div",{className:"p-4 flex flex-col items-center justify-center text-center",children:[(0,b.jsx)(L.FileText,{className:"w-10 h-10 text-primary"}),(0,b.jsx)("p",{className:"mt-2 text-xs font-medium break-all max-w-xs",children:a.name}),(0,b.jsx)("a",{href:a.url,target:"_blank",rel:"noreferrer",className:"mt-2",children:(0,b.jsx)(h.Button,{variant:"outline",size:"sm",children:"Ver"})})]}):(0,b.jsx)("img",{src:a.url,alt:`Vista previa ${c+1}`,className:"w-full h-full object-cover"})}),(0,b.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,b.jsxs)(C.Tooltip,{children:[(0,b.jsx)(C.TooltipTrigger,{asChild:!0,children:(0,b.jsx)(h.Button,{type:"button",variant:"destructive",size:"icon",onClick:()=>{m(l.filter((a,b)=>b!==c)),w(t.filter((a,b)=>b!==c))},children:(0,b.jsx)(u.X,{className:"h-4 w-4"})})}),(0,b.jsx)(C.TooltipContent,{children:(0,b.jsx)("p",{children:"Eliminar archivo"})})]})})]},c)),(0,b.jsxs)("div",{className:"border-2 border-dashed rounded-lg flex flex-col items-center justify-center text-center cursor-pointer hover:bg-muted/50 transition-colors aspect-square",onClick:()=>aa.current?.click(),children:[(0,b.jsx)(F,{className:"w-8 h-8 text-primary"}),(0,b.jsx)("p",{className:"mt-2 text-sm font-semibold",children:"AÃ±adir mÃ¡s"})]})]}):(0,b.jsxs)("div",{className:"border-2 border-dashed rounded-lg flex flex-col items-center justify-center p-20 text-center cursor-pointer hover:bg-muted/50 transition-colors",onClick:()=>aa.current?.click(),children:[(0,b.jsx)("div",{className:"mx-auto w-16 h-16 rounded-lg bg-primary/10 flex items-center justify-center mb-4",children:(0,b.jsx)(F,{className:"w-8 h-8 text-primary"})}),(0,b.jsx)("p",{className:"mt-4 font-semibold",children:"Seleccionar Archivos"}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"o arrastra y suelta aquÃ­"}),(0,b.jsxs)("div",{className:"mt-6 flex items-center justify-center gap-2 flex-wrap",children:[(0,b.jsx)(r.Badge,{variant:"outline",className:"text-xs",children:"JPG"}),(0,b.jsx)(r.Badge,{variant:"outline",className:"text-xs",children:"PNG"}),(0,b.jsx)(r.Badge,{variant:"outline",className:"text-xs",children:"WEBP"}),(0,b.jsx)(r.Badge,{variant:"outline",className:"text-xs",children:"PDF"})]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-4",children:"MÃ¡ximo 10MB por archivo"})]}),(0,b.jsxs)(h.Button,{type:"button",variant:"outline",className:"w-full",onClick:()=>{_(!0)},children:[(0,b.jsx)(G.Camera,{className:"h-4 w-4 mr-2"}),"Tomar y AÃ±adir Foto"]})]}),(0,b.jsxs)("div",{className:"space-y-6 pt-6 border-t",children:[(0,b.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6",children:(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n,{htmlFor:"monto",children:"Monto (S/)"}),(0,b.jsx)(j,{id:"monto",type:"number",step:"0.01",min:"0",value:x,onChange:a=>D(a.target.value),required:!0,placeholder:"0.00"})]})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n,{htmlFor:"descripcion",children:"DescripciÃ³n"}),(0,b.jsx)(o,{id:"descripcion",value:O,onChange:a=>P(a.target.value),required:!0,placeholder:"Ej: Almuerzo con cliente, taxi al aeropuerto, etc.",rows:4})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 items-end",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(n,{htmlFor:"tipo",children:"Tipo de Gasto"}),(0,b.jsxs)(p.Select,{value:Q,onValueChange:R,children:[(0,b.jsx)(p.SelectTrigger,{id:"tipo",children:(0,b.jsx)(p.SelectValue,{placeholder:"Selecciona un tipo"})}),(0,b.jsxs)(p.SelectContent,{children:[(0,b.jsx)(p.SelectItem,{value:"desayuno",children:"ðŸŒ… Desayuno"}),(0,b.jsx)(p.SelectItem,{value:"almuerzo",children:"ðŸ½ï¸ Almuerzo"}),(0,b.jsx)(p.SelectItem,{value:"cena",children:"ðŸŒ™ Cena"}),(0,b.jsx)(p.SelectItem,{value:"otro",children:"ðŸ“ Otro"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,b.jsx)(s.Switch,{id:"createTxt",checked:S,onCheckedChange:T}),(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)(n,{htmlFor:"createTxt",className:"text-sm cursor-pointer",children:"Crear .txt en OneDrive"}),(0,b.jsxs)(C.Tooltip,{children:[(0,b.jsx)(C.TooltipTrigger,{asChild:!0,children:(0,b.jsx)("span",{className:"text-xs text-muted-foreground cursor-help",children:"Â¿QuÃ© es esto?"})}),(0,b.jsx)(C.TooltipContent,{children:(0,b.jsx)("p",{children:"Crea un archivo de texto adicional con la informaciÃ³n del viÃ¡tico en OneDrive"})})]})]})]})]})]}),W&&(0,b.jsxs)(q.Alert,{variant:"destructive",children:[(0,b.jsx)(I,{className:"h-4 w-4"}),(0,b.jsx)(q.AlertTitle,{children:"Error"}),(0,b.jsx)(q.AlertDescription,{children:W})]}),Y&&(0,b.jsxs)(q.Alert,{children:[(0,b.jsx)(J.CheckCircle2,{className:"h-4 w-4"}),(0,b.jsx)(q.AlertTitle,{children:"Ã‰xito"}),(0,b.jsx)(q.AlertDescription,{children:"ViÃ¡tico registrado correctamente. Redirigiendo..."})]})]}),(0,b.jsx)(g.CardFooter,{className:"flex justify-end",children:(0,b.jsx)(h.Button,{type:"submit",size:"lg",disabled:U,className:"min-w-[200px]",children:U?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(H.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Registrando..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(E,{className:"mr-2 h-4 w-4"}),"Registrar ViÃ¡tico"]})})})]})}),(0,b.jsx)(v,{open:$,onOpenChange:_,children:(0,b.jsxs)(y,{className:"max-w-4xl",children:[(0,b.jsxs)(z,{children:[(0,b.jsx)(A,{children:"Tomar Foto"}),(0,b.jsx)(B,{children:"Captura una foto de tu comprobante usando la cÃ¡mara"})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("video",{id:"video",autoPlay:!0,className:"w-full rounded-lg",style:{display:"block"}}),(0,b.jsx)("canvas",{id:"canvas",style:{display:"none"}}),(0,b.jsxs)("div",{className:"flex gap-3 justify-end",children:[(0,b.jsx)(h.Button,{variant:"outline",onClick:()=>_(!1),children:"Cancelar"}),(0,b.jsxs)(h.Button,{onClick:()=>{let a=document.getElementById("video"),b=document.getElementById("canvas");if(!a||!b)return;let c=b.getContext("2d");c&&(b.width=a.videoWidth,b.height=a.videoHeight,c.drawImage(a,0,0),b.toBlob(a=>{if(a){let b=new File([a],`foto-${Date.now()}.jpg`,{type:"image/jpeg"});m([...l,b]),w([...t,{url:URL.createObjectURL(a),isPdf:!1,name:b.name}]),_(!1)}},"image/jpeg",.8))},children:[(0,b.jsx)(G.Camera,{className:"h-4 w-4 mr-2"}),"Capturar Foto"]})]})]})]})})]})})})}):(0,b.jsx)(N.default,{children:(0,b.jsx)(M.default,{children:(0,b.jsx)("div",{className:"max-w-5xl mx-auto space-y-6",children:(0,b.jsxs)(g.Card,{children:[(0,b.jsxs)(g.CardHeader,{children:[(0,b.jsx)(g.CardTitle,{children:"Acceso Restringido"}),(0,b.jsx)(g.CardDescription,{children:"No tienes permiso para acceder a esta pÃ¡gina"})]}),(0,b.jsx)(g.CardContent,{children:(0,b.jsxs)(q.Alert,{variant:"destructive",children:[(0,b.jsx)(I,{className:"h-4 w-4"}),(0,b.jsx)(q.AlertTitle,{children:"Sin Permiso"}),(0,b.jsxs)(q.AlertDescription,{children:["Tu carpeta de OneDrive no estÃ¡ habilitada. No puedes subir viÃ¡ticos en este momento. Por favor, contacta al administrador para habilitar tu cuenta.",(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),"SerÃ¡s redirigido al dashboard..."]})]})})]})})})})}a.s(["default",()=>O],21705)}];

//# sourceMappingURL=src_app_nuevo-viatico_page_tsx_9c6f221b._.js.map